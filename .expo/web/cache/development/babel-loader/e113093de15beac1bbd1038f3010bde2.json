{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _regeneratorRuntime from \"@babel/runtime/regenerator\";\nimport React, { useEffect, useState } from 'react';\nimport View from \"react-native-web/dist/exports/View\";\nimport StyleSheet from \"react-native-web/dist/exports/StyleSheet\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport Image from \"react-native-web/dist/exports/Image\";\nimport Alert from \"react-native-web/dist/exports/Alert\";\nimport * as Location from 'expo-location';\nimport { fetchAddresses, insertAddress } from \"../db\";\nexport var getLocation = function getLocation() {\n  var _useState = useState(null),\n      _useState2 = _slicedToArray(_useState, 2),\n      location = _useState2[0],\n      setLocation = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      street = _useState4[0],\n      setStreet = _useState4[1];\n\n  var _useState5 = useState([]),\n      _useState6 = _slicedToArray(_useState5, 2),\n      streetsSaved = _useState6[0],\n      setStreetsSaved = _useState6[1];\n\n  var _useState7 = useState(null),\n      _useState8 = _slicedToArray(_useState7, 2),\n      mostrar = _useState8[0],\n      setMostrar = _useState8[1];\n\n  var getPermissionsLocation = function getPermissionsLocation() {\n    var permission;\n    return _regeneratorRuntime.async(function getPermissionsLocation$(_context) {\n      while (1) {\n        switch (_context.prev = _context.next) {\n          case 0:\n            _context.next = 2;\n            return _regeneratorRuntime.awrap(Location.requestForegroundPermissionsAsync());\n\n          case 2:\n            permission = _context.sent;\n\n            if (!(permission.status !== 'granted')) {\n              _context.next = 6;\n              break;\n            }\n\n            console.log(permission);\n            return _context.abrupt(\"return\", false);\n\n          case 6:\n            return _context.abrupt(\"return\", true);\n\n          case 7:\n          case \"end\":\n            return _context.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var handleGetLocation = function handleGetLocation() {\n    var isLocationOk, location;\n    return _regeneratorRuntime.async(function handleGetLocation$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            _context2.next = 2;\n            return _regeneratorRuntime.awrap(getPermissionsLocation());\n\n          case 2:\n            isLocationOk = _context2.sent;\n\n            if (isLocationOk) {\n              _context2.next = 5;\n              break;\n            }\n\n            return _context2.abrupt(\"return\");\n\n          case 5:\n            _context2.next = 7;\n            return _regeneratorRuntime.awrap(Location.getCurrentPositionAsync({\n              timeout: 5000\n            }));\n\n          case 7:\n            location = _context2.sent;\n            setLocation({\n              lat: location.coords.latitude,\n              lng: location.coords.longitude\n            });\n\n          case 9:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var convertLocation = function convertLocation() {\n    var KEY_POSITION_STACK, response, data;\n    return _regeneratorRuntime.async(function convertLocation$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            KEY_POSITION_STACK = '32ffc23fc773c795dde3453c8ceeac6d';\n            _context3.next = 3;\n            return _regeneratorRuntime.awrap(fetch(\"http://api.positionstack.com/v1/reverse?access_key=\" + KEY_POSITION_STACK + \"&query=\" + location.lat + \",\" + location.lng));\n\n          case 3:\n            response = _context3.sent;\n            _context3.next = 6;\n            return _regeneratorRuntime.awrap(response.json());\n\n          case 6:\n            data = _context3.sent;\n            setStreet(data.data[0]);\n\n          case 8:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  var saveLocation = function saveLocation() {\n    var response;\n    return _regeneratorRuntime.async(function saveLocation$(_context4) {\n      while (1) {\n        switch (_context4.prev = _context4.next) {\n          case 0:\n            _context4.next = 2;\n            return _regeneratorRuntime.awrap(insertAddress(street.label, location.lat, location.lng));\n\n          case 2:\n            response = _context4.sent;\n\n          case 3:\n          case \"end\":\n            return _context4.stop();\n        }\n      }\n    }, null, null, null, Promise);\n  };\n\n  useEffect(function () {\n    (function _callee() {\n      var response;\n      return _regeneratorRuntime.async(function _callee$(_context5) {\n        while (1) {\n          switch (_context5.prev = _context5.next) {\n            case 0:\n              _context5.next = 2;\n              return _regeneratorRuntime.awrap(fetchAddresses());\n\n            case 2:\n              response = _context5.sent;\n              setStreetsSaved(response.rows._array);\n              if (streetsSaved.length !== 0) setMostrar(JSON.parse(JSON.stringify(streetsSaved[0])));\n              console.log(streetsSaved[0].address + 'hola');\n\n            case 6:\n            case \"end\":\n              return _context5.stop();\n          }\n        }\n      }, null, null, null, Promise);\n    })();\n  }, []);\n  console.log('guardado');\n  console.log(streetsSaved[0]);\n  console.log(streetsSaved.length);\n\n  var seeLocation = function seeLocation() {\n    return React.createElement(View, null, React.createElement(Text, null, streetsSaved.length));\n  };\n\n  return React.createElement(View, {\n    style: styles.preview\n  }, !location ? React.createElement(TouchableOpacity, {\n    onPress: function onPress() {\n      return handleGetLocation();\n    },\n    style: styles.appButtonContainer\n  }, React.createElement(Text, {\n    style: styles.texto\n  }, \"Get location\")) : React.createElement(React.Fragment, null, React.createElement(View, {\n    style: styles.container\n  }, React.createElement(Text, null, \" Latitud: \", location.lat, \", longitud: \", location.lng, \" \")), React.createElement(TouchableOpacity, {\n    onPress: function onPress() {\n      return convertLocation();\n    },\n    style: styles.appButtonContainer\n  }, React.createElement(Text, {\n    style: styles.texto\n  }, \"See street\")), street && React.createElement(React.Fragment, null, React.createElement(Text, null, street.label), React.createElement(TouchableOpacity, {\n    onPress: function onPress() {\n      return saveLocation();\n    },\n    style: styles.appButtonContainer\n  }, React.createElement(Text, {\n    style: styles.texto\n  }, \"Save all in SQLite\")))), React.createElement(TouchableOpacity, {\n    onPress: function onPress() {\n      return seeLocation();\n    },\n    style: styles.appButtonContainer\n  }, React.createElement(Text, {\n    style: styles.texto\n  }, \"Ver Guardadas\")));\n};\nvar styles = StyleSheet.create({\n  preview: {\n    width: '100%',\n    height: 200,\n    marginBottom: 10,\n    justifyContent: 'center',\n    alignItems: 'center',\n    borderWidth: 1\n  },\n  container: {\n    flex: 1,\n    shadowColor: 'black',\n    shadowOpacity: 0.26,\n    shadowOffset: {\n      width: 0,\n      height: 2\n    },\n    shadowRadius: 6,\n    elevation: 8,\n    justifyContent: 'center',\n    alignItems: 'center',\n    padding: 8\n  },\n  imagen: {\n    width: '100%',\n    height: '100%'\n  },\n  appButtonContainer: {\n    backgroundColor: \"#000\",\n    paddingVertical: 10,\n    paddingHorizontal: 12,\n    borderRadius: 2,\n    marginBottom: 10\n  },\n  texto: {\n    color: 'white'\n  }\n});","map":{"version":3,"sources":["/home/ggatica/Escritorio/ProyectoEntrega/components/getLocation.js"],"names":["React","useEffect","useState","Location","fetchAddresses","insertAddress","getLocation","location","setLocation","street","setStreet","streetsSaved","setStreetsSaved","mostrar","setMostrar","getPermissionsLocation","requestForegroundPermissionsAsync","permission","status","console","log","handleGetLocation","isLocationOk","getCurrentPositionAsync","timeout","lat","coords","latitude","lng","longitude","convertLocation","KEY_POSITION_STACK","fetch","response","json","data","saveLocation","label","rows","_array","length","JSON","parse","stringify","address","seeLocation","styles","preview","appButtonContainer","texto","container","StyleSheet","create","width","height","marginBottom","justifyContent","alignItems","borderWidth","flex","shadowColor","shadowOpacity","shadowOffset","shadowRadius","elevation","padding","imagen","backgroundColor","paddingVertical","paddingHorizontal","borderRadius","color"],"mappings":"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","sourcesContent":["import React, {useEffect, useState} from 'react'\nimport { View, StyleSheet, Text, TouchableOpacity, Image, Alert} from 'react-native';\nimport * as Location from 'expo-location';\n\nimport { fetchAddresses, insertAddress } from '../db';\n\nexport const getLocation = () => {\n\n    const [location, setLocation] = useState(null);\n  \n    const [street, setStreet] = useState(null);\n    const [streetsSaved, setStreetsSaved] = useState([])\n\n    const [mostrar,setMostrar] = useState(null)\n\n    const getPermissionsLocation = async() => {\n\n        \n        const permission = await Location.requestForegroundPermissionsAsync();\n\n        if (permission.status !== 'granted'){\n            console.log(permission);\n            return false\n        }\n        return true\n    }\n\n    const handleGetLocation = async () => {\n        const isLocationOk = await getPermissionsLocation();\n    \n        if (!isLocationOk) return;\n\n        const location = await Location.getCurrentPositionAsync({\n            timeout: 5000,\n        })\n\n      \n        setLocation({\n            lat: location.coords.latitude,\n            lng: location.coords.longitude,\n        })\n    }\n\n    const convertLocation = async () => {\n        const KEY_POSITION_STACK='32ffc23fc773c795dde3453c8ceeac6d'\n        const response = await fetch(`http://api.positionstack.com/v1/reverse?access_key=${KEY_POSITION_STACK}&query=${location.lat},${location.lng}`);\n        const data = await response.json();\n        setStreet(data.data[0])\n    }\n\n    const saveLocation = async () => {\n        const response = await insertAddress(street.label, location.lat, location.lng);\n    }\n\n    useEffect(()=> {\n        ( async()=> {\n            const response = await fetchAddresses ()\n           \n            setStreetsSaved (response.rows._array)\n            if (streetsSaved.length !==0)\n            setMostrar(JSON.parse(JSON.stringify(streetsSaved[0])))\n           \n           console.log(streetsSaved[0].address +'hola')\n        })()\n        \n    }, [])\n    console.log('guardado')\n    console.log(streetsSaved[0]);\n   //console.log(streetsSaved);\n   console.log(streetsSaved.length)\n  \n//    console.log('adress individual')\n//    if (streetsSaved.length !==0){\n//     console.log(JSON.parse(JSON.stringify(streetsSaved[0])))\n//     setMostrar(JSON.parse(JSON.stringify(streetsSaved[0])))\n//    }\n\n\n    const seeLocation =()=>{\n        return (\n            <View>\n                <Text>{streetsSaved.length}</Text>\n            </View>\n        )\n    }\n\n\n\n\n\n\n\n    return (        \n        <View style={styles.preview}>\n             \n            {!location ?\n            <TouchableOpacity onPress={()=> handleGetLocation()} style={styles.appButtonContainer}>\n                <Text style={styles.texto}>Get location</Text>\n            </TouchableOpacity>\n            : <>\n            <View  style={styles.container}>\n                <Text> Latitud: {location.lat}, longitud: {location.lng} </Text>\n            </View>\n           \n            <TouchableOpacity onPress={()=> convertLocation()} style={styles.appButtonContainer}>\n                <Text style={styles.texto}>See street</Text>\n            </TouchableOpacity>\n\n            {street&&\n                <>\n                    <Text>{street.label}</Text>\n                    <TouchableOpacity onPress={()=> saveLocation()} style={styles.appButtonContainer}>\n                        <Text style={styles.texto}>Save all in SQLite</Text>\n                        \n                    </TouchableOpacity>\n                </>\n            }\n            </>\n            \n            }\n              <TouchableOpacity onPress={()=> seeLocation()} style={styles.appButtonContainer}>\n                <Text style={styles.texto}>Ver Guardadas</Text>\n              </TouchableOpacity>\n\n        \n        </View>\n          \n        \n    )\n}\n\nconst styles = StyleSheet.create({\n    preview: {\n        width: '100%',\n        height: 200,\n        marginBottom: 10,\n        justifyContent: 'center',\n        alignItems: 'center',\n        borderWidth: 1,\n\n    },\n    container:{\n        flex:1, \n        shadowColor:'black',\n        shadowOpacity: 0.26,\n        shadowOffset: {width:0,height:2},\n        shadowRadius:6,\n        elevation:8,\n        justifyContent: 'center',\n        alignItems: 'center',\n        padding:8,\n    },\n    imagen: {\n        width: '100%',\n        height: '100%',\n    },\n    appButtonContainer: {\n        backgroundColor: \"#000\",\n        paddingVertical: 10,\n        paddingHorizontal: 12,\n        borderRadius: 2,\n        marginBottom: 10,\n      },\n      texto:{\n        color:'white'\n      }\n})\n"]},"metadata":{},"sourceType":"module"}